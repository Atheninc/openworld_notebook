<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>World Notes â€“ Map Annotator</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>World Notes â€“ Open World Annotator</h1>
  </header>

  <main>
    <section class="controls">
      <div class="block">
        <h2>Carte</h2>
        <label>
          Map :
          <select id="map-select"></select>
        </label>

        <div class="inline-form">
          <input id="new-map-name" placeholder="Nom de la map" />
          <input id="new-map-image" placeholder="Chemin image (ex: /maps/exemple-map.png)" />
          <button id="create-map-btn">+ Ajouter map (manuel)</button>
        </div>

        <div id="drop-zone">
          Glisse une image de map ici<br />
          ou clique pour sÃ©lectionner
          <input type="file" id="map-file-input" accept="image/*" hidden />
        </div>
      </div>

      <div class="block">
        <h2>Layers</h2>
        <label>
          Layer :
          <select id="layer-select">
            <option value="">(Tous)</option>
          </select>
        </label>
        <div class="inline-form">
          <input id="new-layer-name" placeholder="Nom du layer" />
          <button id="create-layer-btn">+ Ajouter layer</button>
        </div>
      </div>

      <div class="block">
        <h2>Filtres</h2>
        <label>
          Type :
          <select id="type-filter">
            <option value="">(Tous)</option>
            <option value="character">Personnage</option>
            <option value="place">Lieu</option>
            <option value="event">Ã‰vÃ¨nement</option>
            <option value="easter_egg">Easter Egg</option>
            <option value="architecture">Architecture</option>
          </select>
        </label>
      </div>

      <div class="block">
        <h2>Navigation</h2>
        <p class="hint">
          ğŸ–± Molette : zoom / dÃ©zoom<br />
          â¬‡ï¸ Clique milieu : drag pour dÃ©placer la carte
        </p>
      </div>

      <div class="block">
        <h2>Import/Export</h2>
        <div class="buttons">
          <button type="button" id="export-btn">ğŸ“¥ Exporter</button>
          <button type="button" id="import-btn">ğŸ“¤ Importer</button>
        </div>
        <input type="file" id="import-file-input" accept=".json" hidden />
      </div>
    </section>

    <section class="content">
      <div class="map-container">
        <div id="map-wrapper">
          <div id="map-inner">
            <canvas id="map-canvas"></canvas>
            <div id="markers-layer"></div>
          </div>
        </div>
        <p class="hint">
          Clic gauche sur la carte :<br />
          â€¢ mode normal â†’ prÃ©parer une nouvelle annotation<br />
          â€¢ mode dessin â†’ ajouter un point de zone (shape)
        </p>
      </div>

      <aside class="sidebar">
        <div class="tabs">
          <button class="tab-btn active" data-tab="annotations">ğŸ“ Annotations</button>
          <button class="tab-btn" data-tab="characters">ğŸ‘¤ Personnages</button>
          <button class="tab-btn" data-tab="places">ğŸ“ Lieux</button>
          <button class="tab-btn" data-tab="events">ğŸ‰ Ã‰vÃ©nements</button>
          <button class="tab-btn" data-tab="media">ğŸ–¼ï¸ MÃ©dias</button>
          <button class="tab-btn" data-tab="missions">ğŸ¯ Missions</button>
        </div>

        <!-- Onglet Annotations -->
        <div class="tab-content active" id="tab-annotations">
          <h2>DÃ©tails de l'annotation</h2>
          <form id="annotation-form">
            <input type="hidden" id="annot-id" />

            <label>
              Titre :
              <input id="annot-title" required />
            </label>

            <label>
              Type :
              <select id="annot-type" required>
                <option value="character">Personnage</option>
                <option value="place">Lieu</option>
                <option value="event">Ã‰vÃ¨nement</option>
                <option value="easter_egg">Easter Egg</option>
                <option value="architecture">Architecture</option>
              </select>
            </label>

            <label>
              Description / notes :
              <textarea id="annot-description" rows="4"></textarea>
            </label>

            <label>
              DÃ©bloquÃ©e :
              <input type="checkbox" id="annot-unlocked" checked />
              <span style="font-size: 11px; color: #aaa;">Si dÃ©cochÃ©e, l'annotation sera masquÃ©e jusqu'Ã  ce qu'une mission la dÃ©bloque</span>
            </label>

            <label>
              Tags (sÃ©parÃ©s par des virgules) :
              <input id="annot-tags" placeholder="village, boss, quÃªte principale" />
            </label>

            <label>
              RÃ©fÃ©rences (une URL par ligne) :
              <textarea id="annot-refs" rows="4" placeholder="https://youtu.be/...\nhttps://artstation.com/..."></textarea>
            </label>

            <div class="buttons">
              <button type="submit">ğŸ’¾ Enregistrer</button>
              <button type="button" id="delete-annot-btn">ğŸ—‘ Supprimer</button>
            </div>
          </form>

          <h3>Liste des annotations</h3>
          <ul id="annotations-list"></ul>

          <h3>Zones (shapes) du layer</h3>
          <div class="shape-tools">
            <label>
              Nom de la zone :
              <input id="shape-name" placeholder="Biome, rÃ©gion, donjon..." />
            </label>
            <label>
              Style :
              <select id="shape-style">
                <option value="filled">Plein</option>
                <option value="dashed">PointillÃ©</option>
                <option value="hatched">HachurÃ©</option>
              </select>
            </label>
            <button type="button" id="start-shape-btn">âœï¸ Dessiner une zone</button>
            <button type="button" id="finish-shape-btn" disabled>âœ… Terminer la zone</button>
            <p class="hint">
              Clique sur la carte pour poser les points du polygone.<br />
              Il faut au moins 3 points, puis termine pour enregistrer.
            </p>
          </div>
          <ul id="shapes-list"></ul>

          <h3>Chemins (paths) du layer</h3>
          <div class="path-tools">
            <label>
              Nom du chemin :
              <input id="path-name" placeholder="Route, sentier, riviÃ¨re..." />
            </label>
            <button type="button" id="start-path-btn">ğŸ›¤ï¸ Dessiner un chemin</button>
            <button type="button" id="finish-path-btn" disabled>âœ… Terminer le chemin</button>
            <p class="hint">
              Clique sur la carte pour poser les points du chemin.<br />
              Il faut au moins 2 points, puis termine pour enregistrer.
            </p>
          </div>
          <ul id="paths-list"></ul>
        </div>

        <!-- Onglet Personnages -->
        <div class="tab-content" id="tab-characters">
          <h2>Personnages</h2>
          <ul id="characters-list"></ul>
          <div id="character-detail" style="display: none;">
            <h3 id="character-detail-title"></h3>
            <p id="character-detail-description"></p>
            <div id="character-media"></div>
          </div>
        </div>

        <!-- Onglet Lieux -->
        <div class="tab-content" id="tab-places">
          <h2>Lieux</h2>
          <ul id="places-list"></ul>
          <div id="place-detail" style="display: none;">
            <h3 id="place-detail-title"></h3>
            <p id="place-detail-description"></p>
            <div id="place-media"></div>
          </div>
        </div>

        <!-- Onglet Ã‰vÃ©nements -->
        <div class="tab-content" id="tab-events">
          <h2>Ã‰vÃ©nements</h2>
          <ul id="events-list"></ul>
          <div id="event-detail" style="display: none;">
            <h3 id="event-detail-title"></h3>
            <p id="event-detail-description"></p>
            <div id="event-media"></div>
          </div>
        </div>

        <!-- Onglet MÃ©dias -->
        <div class="tab-content" id="tab-media">
          <h2>Tous les mÃ©dias</h2>
          <div id="all-media-list"></div>
        </div>

        <!-- Onglet Missions -->
        <div class="tab-content" id="tab-missions">
          <h2>Gestionnaire de missions</h2>
          
          <!-- Indicateur de progression -->
          <div id="progression-panel" style="background: #2a2a2a; padding: 12px; border-radius: 4px; margin-bottom: 16px;">
            <h3 style="margin-top: 0;">ğŸ“Š Progression de l'exploration</h3>
            <div id="progression-content">Chargement...</div>
          </div>
          
          <div style="display: flex; gap: 12px; margin-bottom: 16px;">
            <button type="button" id="new-mission-btn">â• Nouvelle mission</button>
            <button type="button" id="show-graph-btn">ğŸ“ˆ Voir le graphique</button>
          </div>
          
          <!-- Graphique des missions -->
          <div id="mission-graph-container" style="display: none; background: #1a1a1a; padding: 16px; border-radius: 4px; margin-bottom: 16px; min-height: 300px; overflow: auto;">
            <h3 style="margin-top: 0;">Graphique des missions</h3>
            <canvas id="mission-graph-canvas" style="width: 100%; height: 400px; border: 1px solid #444;"></canvas>
          </div>
          
          <div id="mission-form" style="display: none;">
            <input type="hidden" id="mission-id" />
            <label>
              Titre :
              <input id="mission-title" required />
            </label>
            <label>
              Description :
              <textarea id="mission-description" rows="3"></textarea>
            </label>
            <label>
              Statut :
              <select id="mission-status">
                <option value="todo">Ã€ faire</option>
                <option value="in_progress">En cours</option>
                <option value="completed">TerminÃ©e</option>
                <option value="cancelled">AnnulÃ©e</option>
              </select>
            </label>
            <label>
              PrioritÃ© :
              <input type="number" id="mission-priority" min="0" max="10" value="0" />
            </label>
            <div class="buttons">
              <button type="button" id="save-mission-btn">ğŸ’¾ Enregistrer</button>
              <button type="button" id="cancel-mission-btn">âŒ Annuler</button>
            </div>
          </div>
          <ul id="missions-list"></ul>
          <div id="mission-detail" style="display: none;">
            <h3 id="mission-detail-title"></h3>
            <p id="mission-detail-description"></p>
            <p><strong>Statut :</strong> <span id="mission-detail-status"></span></p>
            <p><strong>PrioritÃ© :</strong> <span id="mission-detail-priority"></span></p>
            
            <h4>PrÃ©requis (missions requises)</h4>
            <ul id="mission-required-list"></ul>
            <button type="button" id="add-required-mission-btn">â• Ajouter un prÃ©requis</button>
            
            <h4>DÃ©bloque (missions suivantes)</h4>
            <ul id="mission-dependent-list"></ul>
            
            <h4>Annotations liÃ©es</h4>
            <ul id="mission-annotations-list"></ul>
            <button type="button" id="add-annotation-to-mission-btn">â• Lier une annotation</button>
            
            <h4>Chemins liÃ©s</h4>
            <ul id="mission-paths-list"></ul>
            <button type="button" id="add-path-to-mission-btn">â• Lier un chemin</button>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
